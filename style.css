:root {
    --bg: #f4f7f9; --card: #ffffff; --ink: #2c3e50; --muted: #7f8c8d; --accent: #27ae60;
    --danger: #e74c3c; --warn: #f39c12; --line: #dfe4ea; --header-bg: #ecf0f1;
    --primary-btn-bg: #3498db; --primary-btn-border: #2980b9;
}
html, body { height: 100%; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg); color: var(--ink); margin: 0; line-height: 1.5; font-size: 14px;
}
.app { max-width: 1600px; margin: 24px auto; padding: 0 16px 64px; }
h1 { font-size: 1.8rem; margin: 0; color: #34495e; }
h2 { font-size: 1.2rem; margin: 24px 0 12px; color: #34495e; border-bottom: 2px solid var(--header-bg); padding-bottom: 8px; }
.toolbar { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between; margin-bottom: 16px; }
.toolbar .left, .toolbar .right { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
.header-controls { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
#exampleLoader { font-size: .9rem; padding: 6px 10px; width: auto; border-radius: 8px; }
.card { background: var(--card); border: 1px solid var(--line); border-radius: 12px; padding: 16px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); margin-bottom: 16px; }
label { font-size: .9rem; color: var(--muted); font-weight: 600; margin-bottom: 4px; display: block; }
input, select, textarea, button {
    background: #fff; color: var(--ink); border: 1px solid var(--line); border-radius: 8px; padding: 9px 12px; font-size: .95rem; width: 100%; box-sizing: border-box;
}
input:focus, select:focus, textarea:focus { outline: 2px solid #3498db; border-color: transparent; }
textarea { resize: none; overflow-y: hidden; min-height: 40px; }

/* --- STYLES FOR EQUIPMENT CHIPS --- */
.equipment-widget { display: flex; flex-direction: column; gap: 6px; }
.chips-container { display: flex; flex-wrap: wrap; gap: 6px; min-height: 28px; }
.chip { 
    background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb;
    padding: 2px 8px; border-radius: 16px; font-size: 0.85rem; 
    display: inline-flex; align-items: center; gap: 6px; user-select: none;
}
.chip-remove { 
    cursor: pointer; font-weight: bold; font-size: 1rem; line-height: 1; 
    color: #1565c0; opacity: 0.6; transition: opacity 0.2s;
}
.chip-remove:hover { opacity: 1; color: #d32f2f; }
.equip-add-select { 
    padding: 4px 8px; font-size: 0.85rem; color: var(--muted); 
    border: 1px dashed var(--line); cursor: pointer;
}
.equip-add-select:hover { border-color: var(--primary-btn-bg); color: var(--ink); }

.grid { display: grid; gap: 16px; }
.meta-grid { grid-template-columns: repeat(6, 1fr); }
.meta-grid .grid-span-full { grid-column: 1 / -1; }
.meta-grid .grid-span-2 { grid-column: span 2; }
.meta-grid .grid-span-3 { grid-column: span 3; }
@media (max-width: 900px) { .meta-grid .grid-span-2, .meta-grid .grid-span-3 { grid-column: span 6; } }
@media (max-width: 1200px) and (min-width: 901px) { .meta-grid .grid-span-3 { grid-column: span 6; } }

.ok { color: var(--accent); } .bad { color: var(--danger); }
.btn { cursor: pointer; transition: all .1s ease; user-select: none; border: none; color: #fff; width: auto; }
.btn:hover { opacity: 0.9; } .btn:active { transform: scale(0.98); }
.btn.primary { background: var(--primary-btn-bg); } .btn.secondary { background: #95a5a6; } .btn.danger { background: var(--danger); }
.btn.small { padding: 5px 10px; font-size: .85rem; border-radius: 6px; }
.lang-btn { background: #fff; color: var(--ink); padding: 6px 12px; font-size: 1.2rem; line-height: 1; }
.lang-btn.active { outline: 2px solid var(--primary-btn-bg); box-shadow: 0 0 5px rgba(52, 152, 219, 0.5); }

.row-actions { display: flex; gap: 6px; align-items: center; justify-content: center; }
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid var(--line); padding: 8px; vertical-align: top; text-align: left; }
th { background: var(--header-bg); font-weight: 600; color: #34495e; white-space: nowrap; }
.phase-header td { background: #3498db; color: white; font-weight: bold; }
.step-header td { background: var(--header-bg); font-weight: bold; }
.kpi { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
.kpi .box { background: var(--header-bg); border: 1px solid var(--line); padding: 8px 12px; border-radius: 8px; }
.spacer { flex: 1; }
.section-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 12px; }
.footnote { font-size: .85rem; color: var(--muted); text-align: center; margin-top: 20px; }
input[type="number"] { text-align: right; }
.text-center { text-align: center; }
.print-only { display: none; }
.fill-in { min-height: 1.3em; }
.print-content { display: none; }

.print-options-compact { display: flex; flex-wrap: wrap; align-items: center; gap: 20px; }
.print-options-compact .option-group { display: flex; align-items: center; gap: 8px; }
.print-options-compact label { margin: 0; font-weight: normal; color: var(--ink); white-space: nowrap; }
.print-options-compact strong { font-weight: 600; color: var(--muted); }
.print-options-compact select { width: auto; padding: 6px 10px; }
.print-options-compact input[type="checkbox"] { width: auto; }

@media print {
    body { background: #fff; color: #000; font-size: 10px; line-height: 1.3; }
    .app { max-width: 100%; margin: 0; padding: 10px; box-shadow: none; }
    .card { box-shadow: none; border: 1px solid #ccc; page-break-inside: avoid; padding: 10px; border-radius: 0; }
    .toolbar, .section-actions, .row-actions, .no-print { display: none !important; }
    h1, h2 { font-size: 1.2rem; color: #000; page-break-after: avoid; margin: 12px 0 8px; padding-bottom: 4px; border-color: #ccc; }
    h1 { font-size: 1.5rem; text-align: center; }
    textarea, select, .equip-add-select, .chip-remove { display: none !important; }
    input { border: none; padding: 0; background: transparent; color: #000; -webkit-print-color-adjust: exact; width: 100%; font-size: inherit; font-family: inherit; box-shadow: none; outline: none; }
    .print-content { display: block !important; white-space: pre-wrap; word-break: break-word; font-family: inherit; font-size: inherit; }
    table { page-break-inside: auto; table-layout: fixed; }
    tr { page-break-inside: avoid; page-break-after: auto; }
    th, td { padding: 4px; border: 1px solid #aaa; vertical-align: middle; word-wrap: break-word; }
    th, .phase-header td { background-color: #e0e0e0 !important; color: #000 !important; -webkit-print-color-adjust: exact; }
    .print-only { display: table-cell !important; }
    .fill-in { border-bottom: none; }
    
    /* Print styles for chips */
    .chips-container { display: block; }
    .chip { background: transparent; border: none; padding: 0; color: #000; display: inline; }
    .chip::after { content: ", "; }
    .chip:last-child::after { content: ""; }

    .card .meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0 16px; padding: 0; }
    .card .meta-grid > div { grid-column: auto !important; display: flex; align-items: baseline; border-bottom: 1px dotted #ccc; padding: 2px 0; }
    .card .meta-grid label { font-weight: 600; margin-right: 6px; padding: 0; color: #000; }
    .card .meta-grid label::after { content: ":"; }
    
    body.print-hide-description .description-card,
    body.print-hide-performance .performance-card,
    body.print-hide-stability .stability-card,
    body.print-hide-supplier .supplier-col,
    body.print-hide-function .func-col,
    body.print-hide-notes .notes-col { display: none; }
    
    body.print-name-trade .inci-col,
    body.print-name-inci .trade-col { display: none; }

    body.print-force-hide-description .description-card,
    body.print-force-hide-performance .performance-card,
    body.print-force-hide-stability .stability-card {
        display: none !important;
    }
}