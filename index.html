<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">–ú–∞—Ä—à—Ä—É—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ v4.3</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app">
    <!-- TOOLBAR -->
    <div class="toolbar card no-print">
        <div class="left">
            <div class="header-controls">
                <h1 data-i18n="title">–ú–∞—Ä—à—Ä—É—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞</h1>
                <select id="exampleLoader">
                    <option value="" data-i18n="loadExample">-- –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä --</option>
                </select>
            </div>
        </div>
        <div class="right">
            <div class="lang-switcher" style="display: flex; gap: 5px;">
                <button class="btn lang-btn" id="langRuBtn" title="–†—É—Å—Å–∫–∏–π">üá∑üá∫</button>
                <button class="btn lang-btn" id="langEnBtn" title="English">üá¨üáß</button>
            </div>
            <button class="btn secondary" id="printBtn" data-i18n="print">üñ®Ô∏è –ü–µ—á–∞—Ç—å / PDF</button>
            <button class="btn secondary" id="saveBtn" data-i18n="save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å JSON</button>
            <label class="btn secondary" for="loadInput" data-i18n="load">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</label>
            <input type="file" id="loadInput" class="no-print" accept=".json" style="display:none" />
            <button class="btn danger" id="clearBtn" data-i18n="clear">‚ùå –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
        </div>
    </div>

    <!-- PRINT OPTIONS (COMPACT) -->
    <div class="card no-print">
        <div class="print-options-compact">
            <div class="option-group">
                <label for="printNameSelect" data-i18n="printNamePriority">–û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:</label>
                <select id="printNameSelect">
                    <option value="trade" data-i18n="printTradeName">–¢–æ—Ä–≥–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</option>
                    <option value="inci" data-i18n="printInciName">INCI</option>
                </select>
            </div>
            <div class="option-group">
                <strong data-i18n="printShowBlocks">–ë–ª–æ–∫–∏:</strong>
                <input type="checkbox" id="printShowDescription" checked><label for="printShowDescription" data-i18n="printDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <input type="checkbox" id="printShowPerformance" checked><label for="printShowPerformance" data-i18n="printPerformance">–¢–µ—Ö. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</label>
                <input type="checkbox" id="printShowStability" checked><label for="printShowStability" data-i18n="printStability">–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</label>
            </div>
            <div class="option-group">
                <strong data-i18n="printShowColumns">–ö–æ–ª–æ–Ω–∫–∏:</strong>
                <input type="checkbox" id="printShowFunction" checked><label for="printShowFunction" data-i18n="printFunction">–§—É–Ω–∫—Ü–∏—è</label>
                <input type="checkbox" id="printShowSupplier" checked><label for="printShowSupplier" data-i18n="printSupplier">–ü–æ—Å—Ç–∞–≤—â–∏–∫</label>
                <input type="checkbox" id="printShowNotes" checked><label for="printShowNotes" data-i18n="printNotes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
            </div>
        </div>
    </div>

    <!-- META INFO -->
    <div class="card">
        <h2 data-i18n="meta">–ö–∞—Ä—Ç–æ—á–∫–∞ –∏–∑–¥–µ–ª–∏—è</h2>
        <div class="grid meta-grid">
            <div class="grid-span-3"><label data-i18n="productName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label><input id="productName" class="data-field" /></div>
            <div class="grid-span-2"><label data-i18n="productCode">–ö–æ–¥ / –ê—Ä—Ç–∏–∫—É–ª</label><input id="productCode" class="data-field" /></div>
            <div><label data-i18n="version">–í–µ—Ä—Å–∏—è</label><input id="docVersion" class="data-field" value="1.0" /></div>
            <div class="grid-span-3"><label data-i18n="author">–¢–µ—Ö–Ω–æ–ª–æ–≥</label><input id="author" class="data-field" /></div>
            <div class="grid-span-2"><label data-i18n="date">–î–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</label><input id="docDate" type="date" class="data-field" /></div>
            <div><label data-i18n="batchSize">–†–∞–∑–º–µ—Ä –ø–∞—Ä—Ç–∏–∏ (–∫–≥)</label><input id="batchSize" type="number" min="0" step="0.01" value="100" class="data-field" /></div>
            <div class="grid-span-full description-card">
                <label data-i18n="description">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                <textarea id="description" rows="2" class="data-field"></textarea>
                <div class="print-content" id="description-print"></div>
            </div>
        </div>
    </div>

    <!-- FORMULATION TABLE -->
    <div class="card">
        <div class="kpi">
            <h2 data-i18n="formulation">–†–µ—Ü–µ–ø—Ç—É—Ä–∞</h2>
            <span class="spacer"></span>
            <div class="box"><span class="muted" data-i18n="totalPercent">–°—É–º–º–∞ %:</span> <strong id="sumPercent">0.00%</strong></div>
        </div>
        <table id="formTable">
            <thead><tr>
                <!-- Removed inline widths to allow 100% fill and proper resizing -->
                <th data-i18n="phase">–§–∞–∑–∞</th>
                <th class="trade-col" data-i18n="tradeName">–¢–æ—Ä–≥. –Ω–∞–∑–≤–∞–Ω–∏–µ</th>
                <th class="inci-col" data-i18n="inciName">INCI</th>
                <th class="func-col" data-i18n="func">–§—É–Ω–∫—Ü–∏—è</th>
                <th class="supplier-col" data-i18n="supplier">–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                <th class="notes-col" data-i18n="notes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                <th data-i18n="percent">%</th>
                <th data-i18n="mass">–ó–∞–≥—Ä—É–∑–∫–∞, –∫–≥</th>
                <th class="no-print"></th> <!-- Actions header empty -->
                <th class="print-only" data-i18n="actualMass">–§–∞–∫—Ç, –∫–≥</th>
            </tr></thead>
            <tbody id="formBody"></tbody>
        </table>
        <div class="section-actions no-print"><button class="btn primary small" id="addIngredientBtn" data-i18n="addIngredient">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</button></div>
    </div>

    <!-- PERFORMANCE DATA -->
    <div class="card performance-card">
        <h2 data-i18n="performance">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
        <table id="perfTable">
            <thead><tr>
                <th data-i18n="perfParam">–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                <th data-i18n="perfValue">–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                <th class="no-print"></th>
            </tr></thead>
            <tbody id="perfBody"></tbody>
        </table>
        <div class="section-actions no-print"><button class="btn primary small" id="addPerfBtn" data-i18n="addPerf">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä</button></div>
    </div>

    <!-- STABILITY DATA -->
    <div class="card stability-card">
        <h2 data-i18n="stability">–î–∞–Ω–Ω—ã–µ –æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏</h2>
        <table id="stabTable">
            <thead><tr>
                <th data-i18n="stabCondition">–£—Å–ª–æ–≤–∏–µ</th>
                <th data-i18n="stabResult">–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                <th class="no-print"></th>
            </tr></thead>
            <tbody id="stabBody"></tbody>
        </table>
        <div class="section-actions no-print"><button class="btn primary small" id="addStabBtn" data-i18n="addStab">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç</button></div>
    </div>

    <!-- EQUIPMENT LIST -->
    <div class="card">
        <h2 data-i18n="equipmentList">–°–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h2>
        <table id="equipmentTable">
            <thead><tr>
                <th data-i18n="eqShortName">ID / –ö–æ–¥</th>
                <th data-i18n="eqFullName">–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                <th data-i18n="eqNotes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è / –§—É–Ω–∫—Ü–∏—è</th>
                <th class="no-print"></th>
            </tr></thead>
            <tbody id="equipmentBody"></tbody>
        </table>
        <div class="section-actions no-print"><button class="btn primary small" id="addEquipmentBtn" data-i18n="addEquipment">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</button></div>
    </div>

    <!-- PROCESS TABLE -->
    <div class="card">
        <h2 data-i18n="process">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å</h2>
        <table id="procTable">
            <thead><tr>
                <th data-i18n="step">‚Ññ</th>
                <th data-i18n="opDescription">–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                <th data-i18n="equipment">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th>
                <th data-i18n="paramName">–ü–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞</th>
                <th data-i18n="norm">–ù–æ—Ä–º–∞</th>
                <th class="no-print"></th> <!-- Actions for Parameters -->
                <th class="print-only" data-i18n="actual">–§–∞–∫—Ç</th>
            </tr></thead>
            <tbody id="procBody"></tbody>
        </table>
        <div class="section-actions no-print"><button class="btn primary small" id="addProcBtn" data-i18n="addStep">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–¥–∏—é</button></div>
    </div>

    <!-- QC TABLE -->
    <div class="card">
        <h2 data-i18n="qc">–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ (–û–ö–ö)</h2>
        <div id="qcContainer"></div>
        <div class="section-actions no-print"><button class="btn primary small" id="addQcBtn" data-i18n="addQc">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è</button></div>
    </div>
    
    <div class="footnote no-print"><span data-i18n="foot">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ.</span></div>
</div>

<!-- TEMPLATES -->
<template id="ingredientRowTpl">
    <tr>
        <td><input class="data-field text-center" data-key="phase" maxlength="5"></td>
        <td class="trade-col">
            <textarea class="data-field" data-key="tradeName" rows="1"></textarea>
            <div class="print-content" data-key="tradeName-print"></div>
        </td>
        <td class="inci-col">
            <textarea class="data-field" data-key="inciName" rows="1"></textarea>
            <div class="print-content" data-key="inciName-print"></div>
        </td>
        <td class="func-col">
            <textarea class="data-field" data-key="func" rows="1"></textarea>
            <div class="print-content" data-key="func-print"></div>
        </td>
        <td class="supplier-col">
            <textarea class="data-field" data-key="supplier" rows="1"></textarea>
            <div class="print-content" data-key="supplier-print"></div>
        </td>
        <td class="notes-col">
            <textarea class="data-field" data-key="notes" rows="1"></textarea>
            <div class="print-content" data-key="notes-print"></div>
        </td>
        <td><input class="data-field text-center" data-key="percent" type="number" min="0" max="100" step="0.01" value="0"></td>
        <td class="mass-cell" style="text-align: right;">0.000</td>
        <td class="no-print row-actions">
            <button class="btn icon-btn delBtn" title="Delete">‚úï</button>
        </td>
        <td class="print-only"><div class="fill-in"></div></td>
    </tr>
</template>

<template id="perfRowTpl">
    <tr>
        <td><input class="data-field" data-key="parameter"></td>
        <td><input class="data-field" data-key="value"></td>
        <td class="no-print row-actions">
            <button class="btn icon-btn delBtn" title="Delete">‚úï</button>
        </td>
    </tr>
</template>

<template id="stabRowTpl">
    <tr>
        <td><input class="data-field" data-key="condition"></td>
        <td><input class="data-field" data-key="result"></td>
        <td class="no-print row-actions">
            <button class="btn icon-btn delBtn" title="Delete">‚úï</button>
        </td>
    </tr>
</template>

<template id="equipmentRowTpl">
    <tr>
        <td><input class="data-field" data-key="shortName"></td>
        <td><input class="data-field" data-key="fullName"></td>
        <td>
            <textarea class="data-field" data-key="notes" rows="1"></textarea>
            <div class="print-content" data-key="notes-print"></div>
        </td>
        <td class="no-print row-actions">
            <button class="btn icon-btn delBtn" title="Delete">‚úï</button>
        </td>
    </tr>
</template>

<template id="procStepRowTpl">
    <tr class="step-header">
        <td class="step-number" style="text-align: center; vertical-align: middle;"></td>
        <td class="step-description" style="vertical-align: middle;">
            <textarea class="data-field" data-key="description" rows="2"></textarea>
            <div class="print-content" data-key="description-print"></div>
            <!-- Delete Step Button moved here for clarity -->
            <button class="btn icon-btn step-delete-btn delBtn" title="Delete Step">‚úï</button>
        </td>
        <td class="step-equipment" style="vertical-align: middle;">
            <div class="equipment-widget no-print">
                <div class="chips-container"></div>
                <select class="equip-add-select">
                    <option value="" disabled selected>‚ûï –î–æ–±–∞–≤–∏—Ç—å...</option>
                </select>
            </div>
            <input type="hidden" class="data-field" data-key="equipment">
            <div class="print-content" data-key="equipment-print"></div>
        </td>
    </tr>
</template>

<template id="procParamRowTpl">
    <tr class="param-row">
        <td><input class="data-field" data-key="name"></td>
        <td><input class="data-field" data-key="norm"></td>
        <td class="no-print row-actions">
            <button class="btn icon-btn delParamBtn" title="Delete parameter">‚úï</button>
        </td>
        <td class="print-only"><div class="fill-in"></div></td>
    </tr>
</template>

<template id="qcBlockTpl">
    <div class="qc-block" style="margin-bottom: 20px;">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
            <input class="data-field" data-key="name" style="font-weight:bold; font-size:1.1rem; border:none; border-bottom:1px solid #ccc; flex:1;">
            <button class="btn icon-btn delQcBtn no-print" title="Delete block">‚úï</button>
        </div>
        <table>
            <thead><tr>
                <th data-i18n="qcParamName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è</th>
                <th data-i18n="qcStandard">–ù–æ—Ä–º–∞—Ç–∏–≤</th>
                <th data-i18n="qcResult">–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                <th style="width: 50px;" class="no-print"></th>
            </tr></thead>
            <tbody></tbody>
        </table>
        <div class="section-actions no-print">
            <button class="btn primary small addQcCheckBtn" data-i18n="addQcCheck">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
        </div>
    </div>
</template>

<template id="qcCheckRowTpl">
    <tr>
        <td><input class="data-field" data-key="parameter"></td>
        <td><input class="data-field" data-key="standard"></td>
        <td><div class="fill-in"></div></td>
        <td class="no-print row-actions">
            <button class="btn icon-btn delQcCheckBtn" title="Delete">‚úï</button>
        </td>
    </tr>
</template>

<script type="module" src="js/main.js"></script>

</body>
</html>